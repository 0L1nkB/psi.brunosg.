<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCID-5-CV: Humor (Depressão + Mania) | Bruno de Souza</title>
    
    <script>
        if(localStorage.getItem('logado') !== 'sim') {
            // window.location.href = "../login.html"; 
        }
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        :root {
            --bg-color: #f0f8ff;
            --primary: #6c5ce7;
            --text: #2d3436;
            --card-bg: #ffffff;
            --positive: #ef5350;
            --negative: #00b894;
            --neutral: #fdcb6e;
            --criteria-bg: #dfe6e9;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#dfe6e9 2px, transparent 2px);
            background-size: 20px 20px;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px 40px;
            border-radius: 20px;
            border: 3px dashed var(--primary);
            box-shadow: 8px 8px 0 rgba(0,0,0,0.05);
            max-width: 900px;
            width: 100%;
            position: relative;
        }

        h1 { margin: 0; color: var(--primary); font-size: 1.8rem; text-transform: uppercase; font-weight: 800; }
        .subtitle { margin-top: 5px; color: #636e72; font-weight: 600; font-size: 0.9rem; }
        .badge { background: var(--primary); color: white; padding: 5px 15px; border-radius: 15px; font-size: 0.8rem; font-weight: 700; position: absolute; top: -15px; right: 20px; }

        #app-container {
            display: grid;
            grid-template-columns: 2fr 1fr 100px;
            gap: 20px;
            width: 100%;
            max-width: 1100px;
            height: 60vh;
            min-height: 500px;
        }

        .question-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            border: 2px solid white;
            position: relative;
            overflow-y: auto;
        }

        .question-code {
            color: var(--primary);
            font-weight: 800;
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: block;
        }

        .question-text {
            font-size: 1.4rem;
            line-height: 1.4;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 25px;
        }

        .sub-questions {
            font-size: 1rem;
            color: #636e72;
            background: #f1f2f6;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid var(--primary);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .instruction {
            margin-top: auto;
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 600;
            border: 1px dashed #ffeeba;
        }

        .criteria-panel {
            background: var(--criteria-bg);
            border-radius: 20px;
            padding: 25px;
            overflow-y: auto;
            border: 2px solid #b2bec3;
            color: #2d3436;
        }

        .criteria-title { 
            font-weight: 800; 
            margin-bottom: 15px; 
            text-transform: uppercase; 
            font-size: 0.9rem; 
            color: #636e72; 
            border-bottom: 2px solid rgba(0,0,0,0.1);
            padding-bottom: 5px;
        }
        
        .criteria-text { font-size: 0.95rem; line-height: 1.5; }

        .action-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            justify-content: center;
        }

        .btn-action {
            width: 100%;
            height: 80px;
            border: none;
            border-radius: 20px;
            font-size: 1.5rem;
            font-weight: 800;
            cursor: pointer;
            color: white;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 0 rgba(0,0,0,0.1);
        }

        .btn-action span { font-size: 0.7rem; font-weight: 600; margin-top: 5px; text-transform: uppercase; }

        .btn-plus { background-color: var(--positive); }
        .btn-minus { background-color: var(--negative); }
        .btn-unsure { background-color: var(--neutral); color: #2d3436; }

        #results-view {
            display: none;
            background: white;
            padding: 40px;
            border-radius: 25px;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .result-item {
            padding: 15px;
            border-bottom: 1px dashed #dfe6e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .diagnosis-box {
            margin-top: 30px;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: 800;
        }
        
        .diag-positive { background: #ff7675; color: white; border: 4px solid #d63031; }
        .diag-negative { background: #55efc4; color: #006266; border: 4px solid #00b894; }
        .diag-neutral { background: #dfe6e9; color: #2d3436; border: 4px solid #b2bec3; }
        
        /* Estilo Específico para Bipolar */
        .diag-bipolar { background: #fdcb6e; color: #d35400; border: 4px solid #e67e22; }

        .back-link {
            position: fixed; top: 20px; left: 20px;
            color: #b2bec3; text-decoration: none; font-weight: 700;
            transition: 0.3s;
        }
        .back-link:hover { color: var(--primary); }

        @media (max-width: 900px) {
            #app-container { display: flex; flex-direction: column; height: auto; }
            .action-panel { flex-direction: row; height: auto; }
            .btn-action { height: 60px; font-size: 1.2rem; }
            .question-panel { min-height: 300px; }
        }
    </style>
</head>
<body>

    <a href="../listaferramentas.html" class="back-link"><i class="fa-solid fa-arrow-left"></i> Voltar</a>

    <header data-aos="fade-down">
        <h1>SCID-5-CV Digital</h1>
        <div class="subtitle" id="module-subtitle">Módulo A: Episódio Depressivo Maior</div>
        <div class="badge" id="progress-display">Item 1</div>
    </header>

    <div id="app-container" data-aos="fade-up">
        
        <div class="question-panel">
            <span class="question-code" id="q-id">A1</span>
            <div class="question-text" id="q-main">Carregando...</div>
            <div class="sub-questions" id="q-sub" style="display:none;"></div>
            <div class="instruction" id="q-inst" style="display:none;"></div>
        </div>

        <div class="criteria-panel">
            <div class="criteria-title"><i class="fa-solid fa-book-medical"></i> Critério DSM-5</div>
            <div class="criteria-text" id="c-text">Carregando...</div>
        </div>

        <div class="action-panel">
            <button class="btn-action btn-plus" onclick="registerScore('+')">
                <i class="fa-solid fa-check"></i> <span>Presente</span>
            </button>
            <button class="btn-action btn-unsure" onclick="registerScore('?')">
                <i class="fa-solid fa-question"></i> <span>Dúvida</span>
            </button>
            <button class="btn-action btn-minus" onclick="registerScore('-')">
                <i class="fa-solid fa-xmark"></i> <span>Ausente</span>
            </button>
        </div>
    </div>

    <div id="results-view">
        <h2 style="text-align:center; color:var(--text)">Sumário da Avaliação</h2>
        <div id="score-list"></div>
        <div id="final-diagnosis" class="diagnosis-box"></div>
        <button class="btn-action btn-unsure" style="margin-top:20px; height:50px; background:#b2bec3" onclick="location.reload()">
            <i class="fa-solid fa-rotate-right"></i> Nova Avaliação
        </button>
    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init();

        const questions = [
            // ==========================================================
            // MÓDULO A: DEPRESSÃO MAIOR
            // ==========================================================
            {
                id: "A1",
                module: "Módulo A: Depressão",
                text: "No último mês, houve algum período em que você se sentiu deprimido ou abatido na maior parte do dia, quase todos os dias?",
                sub: "Alguém comentou que você parecia triste, abatido ou 'para baixo'?",
                criteria: "1. Humor deprimido na maior parte do dia, quase todos os dias."
            },
            {
                id: "A2",
                module: "Módulo A: Depressão",
                text: "Durante esse período, você sentiu menos interesse ou prazer nas coisas que normalmente gosta?",
                sub: "Houve um período em que você 'não sentia gosto por nada'?",
                criteria: "2. Acentuada diminuição de interesse ou prazer em quase todas as atividades."
            },
            // PONTO DE CHECAGEM CRÍTICO (A1/A2)
            {
                id: "CHECK_ENTRY",
                type: "logic",
                check: function(scores) {
                    if (scores['A1'] !== '+' && scores['A2'] !== '+') {
                        return 'JUMP_TO_A14'; // Pula para Passado
                    }
                    return 'NEXT';
                }
            },
            { id: "A3", module: "Módulo A: Depressão", text: "Mudança de apetite ou peso?", criteria: "3. Perda/ganho de peso ou apetite." },
            { id: "A4", module: "Módulo A: Depressão", text: "Como estava dormindo?", criteria: "4. Insônia ou hipersonia." },
            { id: "A5", module: "Módulo A: Depressão", text: "Agitação ou lentidão?", criteria: "5. Agitação ou retardo psicomotor." },
            { id: "A6", module: "Módulo A: Depressão", text: "Fadiga ou perda de energia?", criteria: "6. Fadiga ou perda de energia." },
            { id: "A7", module: "Módulo A: Depressão", text: "Sentimentos de inutilidade ou culpa?", criteria: "7. Inutilidade ou culpa excessiva." },
            { id: "A8", module: "Módulo A: Depressão", text: "Dificuldade de concentração?", criteria: "8. Capacidade diminuída para pensar." },
            { id: "A9", module: "Módulo A: Depressão", text: "Pensamentos de morte?", criteria: "9. Pensamentos de morte/suicídio.", inst: "Se (+), avalie risco." },
            
            // CONTAGEM DE SINTOMAS ATUAIS
            {
                id: "CHECK_COUNT",
                type: "logic",
                check: function(scores) {
                    let count = 0;
                    ['A1','A2','A3','A4','A5','A6','A7','A8','A9'].forEach(k => { if (scores[k] === '+') count++; });
                    if (count < 5) return 'JUMP_TO_A14'; // Não é depressão atual -> Vai para Passado
                    return 'NEXT';
                }
            },
            { id: "A10", module: "Módulo A: Depressão", text: "Prejuízo no funcionamento?", criteria: "B. Sofrimento ou prejuízo." },
            { id: "A11", module: "Módulo A: Depressão", text: "Uso de substâncias ou doença?", criteria: "C. Exclusão de causa orgânica." },
            { id: "A12", module: "Módulo A: Depressão", text: "Início do episódio?", criteria: "Cronologia." },

            // RECORRÊNCIA
            {
                id: "A13",
                module: "Módulo A: Depressão",
                text: "Já teve outro episódio parecido antes?",
                criteria: "Recorrência."
            },
            {
                id: "CHECK_RECURRENCE",
                type: "logic",
                check: function(scores) {
                    // Se confirmou atual (chegou até aqui), agora vamos para MANIA (C1)
                    // Independentemente se é recorrente ou não, precisamos descartar bipolaridade.
                    return 'JUMP_TO_C1'; 
                }
            },

            // --- EPISÓDIO PASSADO (Para quem não tem atual) ---
            { id: "A14", module: "Módulo A: Passado", text: "Já se sentiu deprimido no passado (Pior episódio)?", criteria: "A. Humor Deprimido Passado" },
            { id: "A15", module: "Módulo A: Passado", text: "Já perdeu o interesse no passado?", criteria: "A. Anedonia Passada" },
            {
                id: "CHECK_PAST_CORE",
                type: "logic",
                check: function(scores) {
                    if (scores['A14'] !== '+' && scores['A15'] !== '+') return 'JUMP_TO_C1'; // Sem passado -> Vai para Mania
                    return 'NEXT';
                }
            },
            { id: "A_PAST_FULL", module: "Módulo A: Passado", text: "Teve 5 sintomas ao mesmo tempo no passado?", criteria: "B. Confirmação Passada" },
            
            // ==========================================================
            // MÓDULO C: MANIA / HIPOMANIA (NOVO!)
            // ==========================================================
            {
                id: "C1",
                module: "Módulo C: Mania",
                text: "Agora mudando de assunto: Você já teve algum período em que se sentiu muito animado, eufórico, ou 'no topo do mundo'?",
                sub: "Diferente do seu normal? Alguém comentou que você estava 'acelerado'?",
                criteria: "A. Humor anormalmente elevado ou expansivo.",
                inst: "Se o paciente descrever apenas felicidade normal, marque (-)."
            },
            {
                id: "C2",
                module: "Módulo C: Mania",
                text: "Se não ficou eufórico... houve um período em que você ficou extremamente irritado ou bravo?",
                sub: "Brigando com todos, gritando, desproporcional ao motivo?",
                criteria: "A. Humor anormalmente irritável."
            },
            {
                id: "CHECK_MANIA_ENTRY",
                type: "logic",
                check: function(scores) {
                    if (scores['C1'] !== '+' && scores['C2'] !== '+') {
                        return 'SKIP_TO_END'; // Não é bipolar. Fim da entrevista.
                    }
                    return 'NEXT';
                }
            },
            // SINTOMAS DE MANIA
            { id: "C3", module: "Módulo C: Mania", text: "Sentiu-se grandioso ou com superpoderes?", criteria: "1. Autoestima inflada/Grandiosidade." },
            { id: "C4", module: "Módulo C: Mania", text: "Precisou dormir menos (ex: 3h) e acordou descansado?", criteria: "2. Redução da necessidade de sono." },
            { id: "C5", module: "Módulo C: Mania", text: "Falou muito mais que o habitual?", criteria: "3. Loquacidade/Pressão por falar." },
            { id: "C6", module: "Módulo C: Mania", text: "Pensamentos acelerados?", criteria: "4. Fuga de ideias." },
            { id: "C7", module: "Módulo C: Mania", text: "Distraía-se fácil?", criteria: "5. Distratibilidade." },
            { id: "C8", module: "Módulo C: Mania", text: "Fez muitas atividades ao mesmo tempo?", criteria: "6. Aumento da atividade dirigida." },
            { id: "C9", module: "Módulo C: Mania", text: "Fez coisas arriscadas (gastos, sexo, velocidade)?", criteria: "7. Comportamentos de risco." },

            // CÁLCULO FINAL DA MANIA
            {
                id: "CHECK_MANIA_FINAL",
                type: "logic",
                check: function(scores) {
                    let sCount = 0;
                    ['C3','C4','C5','C6','C7','C8','C9'].forEach(k => { if(scores[k] === '+') sCount++; });
                    
                    // Lógica: Se Euforia (C1+), precisa de 3. Se só Irritabilidade (C1- e C2+), precisa de 4.
                    let threshold = (scores['C1'] === '+') ? 3 : 4;
                    
                    if (sCount >= threshold) {
                        scores['DIAG_BIPOLAR'] = 'YES';
                    }
                    return 'SKIP_TO_END';
                }
            }
        ];

        // ============================================================
        // MOTOR DO APP
        // ============================================================
        let currentIndex = 0;
        let scores = {};

        function loadQuestion() {
            if (currentIndex >= questions.length) {
                showResults();
                return;
            }

            const q = questions[currentIndex];

            // Pulos
            if (q.type === 'logic') {
                const action = q.check(scores);
                if (action === 'SKIP_TO_END') { showResults(); return; } 
                else if (action.startsWith('JUMP_TO_')) {
                    const tId = action.split('JUMP_TO_')[1];
                    const tIndex = questions.findIndex(i => i.id === tId);
                    if (tIndex !== -1) { currentIndex = tIndex; loadQuestion(); }
                    return;
                }
                else { currentIndex++; loadQuestion(); return; }
            }

            // UI Updates
            document.getElementById('module-subtitle').innerText = q.module || "Avaliação";
            document.getElementById('q-id').innerText = q.id;
            document.getElementById('q-main').innerText = q.text;
            document.getElementById('c-text').innerText = q.criteria;
            document.getElementById('progress-display').innerText = `Item ${currentIndex + 1}`;
            
            const subDiv = document.getElementById('q-sub');
            if (q.sub) { subDiv.style.display = 'block'; subDiv.innerText = q.sub; } else { subDiv.style.display = 'none'; }
            
            const instDiv = document.getElementById('q-inst');
            if (q.inst) { instDiv.style.display = 'block'; instDiv.innerText = "NOTA: " + q.inst; } else { instDiv.style.display = 'none'; }
        }

        function registerScore(val) {
            scores[questions[currentIndex].id] = val;
            currentIndex++;
            loadQuestion();
        }

        function showResults() {
            document.getElementById('app-container').style.display = 'none';
            document.getElementById('results-view').style.display = 'block';
            
            const list = document.getElementById('score-list');
            const diagBox = document.getElementById('final-diagnosis');
            list.innerHTML = '';

            // Diagnósticos
            let depCount = 0;
            ['A1','A2','A3','A4','A5','A6','A7','A8','A9'].forEach(k => { if(scores[k] === '+') depCount++; });
            let hasDepression = (scores['A1'] === '+' || scores['A2'] === '+') && depCount >= 5;
            let hasPastDep = scores['A_PAST_FULL'] === '+';
            let isBipolar = scores['DIAG_BIPOLAR'] === 'YES';

            // Lista
            Object.keys(scores).forEach(key => {
                if (key.includes('CHECK') || key === 'DIAG_BIPOLAR') return;
                
                // Divisor visual
                if (key === 'C1') {
                    const sep = document.createElement('div');
                    sep.innerHTML = "<h3 style='margin:20px 0 5px; color:#6c5ce7; border-bottom:1px solid #ddd'>Módulo Mania</h3>";
                    list.appendChild(sep);
                }

                let color = scores[key] === '+' ? '#ef5350' : '#2d3436';
                let weight = scores[key] === '+' ? 'bold' : 'normal';
                
                const div = document.createElement('div');
                div.className = 'result-item';
                div.innerHTML = `<span>${key}</span> <span style="color:${color}; font-weight:${weight}">${scores[key]}</span>`;
                list.appendChild(div);
            });

            // Lógica Final Hierárquica
            if (isBipolar) {
                diagBox.className = "diagnosis-box diag-bipolar";
                let extra = hasDepression ? "<br><small>(Com Episódio Depressivo Atual)</small>" : "";
                diagBox.innerHTML = `<i class='fa-solid fa-bolt'></i> POSSÍVEL TRANSTORNO BIPOLAR${extra}`;
            } else if (hasDepression) {
                diagBox.className = "diagnosis-box diag-positive";
                diagBox.innerHTML = `<i class='fa-solid fa-cloud-rain'></i> DEPRESSÃO UNIPOLAR (TDM)<br><small>Sem histórico de Mania.</small>`;
            } else if (hasPastDep) {
                diagBox.className = "diagnosis-box diag-neutral";
                diagBox.innerHTML = `<i class='fa-solid fa-clock-rotate-left'></i> TDM EM REMISSÃO (Histórico)`;
            } else {
                diagBox.className = "diagnosis-box diag-negative";
                diagBox.innerHTML = `<i class='fa-solid fa-circle-check'></i> SEM DIAGNÓSTICO DE HUMOR`;
            }
        }

        loadQuestion();
    </script>
</body>
</html>

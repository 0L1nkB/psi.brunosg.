<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCID-5-CV: Sistema Completo | Bruno de Souza</title>
    
    <script>
        if(localStorage.getItem('logado') !== 'sim') {
            // window.location.href = "../login.html"; 
        }
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        :root {
            --bg-color: #f0f8ff;
            --sidebar-bg: #2d3436;
            --primary: #6c5ce7;
            --active-item: #a29bfe;
            --text: #2d3436;
            --card-bg: #ffffff;
            
            --positive: #ef5350;
            --negative: #00b894;
            --neutral: #fdcb6e;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            color: var(--text);
            display: flex;
            overflow: hidden; /* Evita rolagem dupla */
        }

        /* --- SIDEBAR (NOVO) --- */
        #sidebar {
            width: 280px;
            background-color: var(--sidebar-bg);
            color: white;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-shadow: 4px 0 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 40px;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
            background: white;
            padding: 10px;
            border-radius: 10px;
        }

        .nav-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #b2bec3;
        }

        .nav-item:hover { background-color: rgba(255,255,255,0.1); color: white; }
        .nav-item.active { background-color: var(--primary); color: white; box-shadow: 0 4px 15px rgba(108, 92, 231, 0.4); }

        .score-badge {
            background: rgba(0,0,0,0.3);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        /* --- ÁREA PRINCIPAL --- */
        #main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            width: 100%;
            max-width: 900px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h2 { margin: 0; color: var(--primary); font-weight: 800; }

        /* GRID DA ENTREVISTA */
        #interview-area {
            display: grid;
            grid-template-columns: 2fr 1fr 100px;
            gap: 20px;
            width: 100%;
            max-width: 1100px;
            height: calc(100vh - 150px); /* Ajusta altura */
        }

        .question-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            border: 2px solid white;
            overflow-y: auto;
        }

        .question-code {
            color: var(--primary);
            font-weight: 800;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.3rem;
            line-height: 1.5;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 20px;
        }

        .sub-questions {
            font-size: 1rem;
            color: #4b6584;
            background: #f1f2f6;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid var(--primary);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .instruction {
            margin-top: auto;
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 600;
            border: 1px dashed #ffeeba;
        }

        .criteria-panel {
            background: #dfe6e9;
            border-radius: 20px;
            padding: 25px;
            overflow-y: auto;
            border: 2px solid #b2bec3;
            color: #2d3436;
        }

        .criteria-text { font-size: 0.9rem; line-height: 1.5; }

        .action-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            justify-content: center;
        }

        .btn-action {
            width: 100%;
            height: 80px;
            border: none;
            border-radius: 20px;
            font-size: 1.5rem;
            font-weight: 800;
            cursor: pointer;
            color: white;
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .btn-action:hover { transform: scale(1.05); }
        .btn-plus { background-color: var(--positive); }
        .btn-minus { background-color: var(--negative); }
        .btn-unsure { background-color: var(--neutral); color: #2d3436; }

        /* PAINEL DE RESULTADO FINAL (DASHBOARD) */
        #dashboard-view {
            display: none;
            width: 100%;
            max-width: 900px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-left: 10px solid #ccc;
        }

        .result-card.positive { border-left-color: var(--positive); }
        .result-card.negative { border-left-color: var(--negative); }

    </style>
</head>
<body>

    <div id="sidebar">
        <div class="brand"><i class="fa-solid fa-brain"></i> SCID-5</div>
        
        <div class="nav-item active" onclick="switchModule('A')" id="nav-A">
            <span><i class="fa-solid fa-cloud-rain"></i> Depressão</span>
            <span class="score-badge" id="score-A">0/9</span>
        </div>
        
        <div class="nav-item" onclick="switchModule('C')" id="nav-C">
            <span><i class="fa-solid fa-bolt"></i> Mania</span>
            <span class="score-badge" id="score-C">0/7</span>
        </div>

        <div class="nav-item" onclick="showDashboard()" style="margin-top:auto; background:#2d3436; border:1px solid #636e72">
            <span><i class="fa-solid fa-chart-pie"></i> Ver Resultados</span>
        </div>
    </div>

    <div id="main-content">
        
        <header id="interview-header">
            <h2 id="module-title">Módulo A: Episódio Depressivo Maior</h2>
            <div style="font-weight:bold; color:#636e72" id="progress-display">Item 1</div>
        </header>

        <div id="interview-area">
            
            <div class="question-panel" data-aos="fade-right">
                <span class="question-code" id="q-id">A1</span>
                <div class="question-text" id="q-text">Carregando...</div>
                
                <div class="sub-questions" id="q-sub" style="display:none;"></div>
                <div class="instruction" id="q-inst" style="display:none;"></div>
            </div>

            <div class="criteria-panel" data-aos="fade-left">
                <div style="font-weight:800; margin-bottom:10px; color:#636e72; text-transform:uppercase; font-size:0.8rem">Critério DSM-5</div>
                <div class="criteria-text" id="c-text">Carregando...</div>
            </div>

            <div class="action-panel">
                <button class="btn-action btn-plus" onclick="registerScore('+')">
                    <i class="fa-solid fa-check"></i>
                </button>
                <button class="btn-action btn-unsure" onclick="registerScore('?')">
                    <i class="fa-solid fa-question"></i>
                </button>
                <button class="btn-action btn-minus" onclick="registerScore('-')">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
        </div>

        <div id="dashboard-view">
            <h1>Sumário Diagnóstico</h1>
            <div id="dashboard-content"></div>
            <button onclick="location.reload()" style="padding:15px; cursor:pointer; margin-top:20px;">Reiniciar Tudo</button>
        </div>

    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init();

        // ============================================================
        // BANCO DE DADOS COMPLETO (Perguntas Expandidas)
        // ============================================================
        const database = {
            'A': [
                {
                    id: "A1",
                    text: "No último mês, desde [DATA], houve algum período de tempo em que você se sentiu deprimido ou abatido na maior parte do dia, quase todos os dias?",
                    sub: "Alguém comentou que você parecia triste, abatido, deprimido ou 'para baixo'? (Se sim: Como foi isso? Você se sentiu assim na maior parte do dia, quase todos os dias?)",
                    criteria: "A. Humor deprimido na maior parte do dia, quase todos os dias, indicado por relato subjetivo (p. ex., sente-se triste, vazio, sem esperança) ou por observação feita por outras pessoas (p. ex., parece choroso).",
                    inst: "Se o paciente estiver visivelmente deprimido, você pode classificar como (+) mesmo se ele negar, baseado na observação."
                },
                {
                    id: "A2",
                    text: "No último mês, houve algum período de tempo em que você perdeu o interesse ou o prazer nas coisas de que você normalmente gosta?",
                    sub: "O que você gosta de fazer? (Você tem feito essas coisas? Você gostou de fazê-las?)",
                    criteria: "B. Acentuada diminuição do interesse ou prazer em todas, ou quase todas, as atividades na maior parte do dia, quase todos os dias."
                },
                { type: 'logic', check: (scores) => (scores['A1']==='+' || scores['A2']==='+') ? 'NEXT' : 'STOP_MODULE' },
                {
                    id: "A3",
                    text: "Como tem estado o seu apetite? (Como foi em comparação ao seu habitual?)",
                    sub: "Você teve que se forçar a comer? (Ou você comeu muito mais do que o habitual?) Você perdeu ou ganhou peso? (Quanto?)",
                    criteria: "C. Perda ou ganho significativo de peso sem estar fazendo dieta (p. ex., uma alteração de mais de 5% do peso corporal em um mês), ou diminuição ou aumento do apetite quase todos os dias."
                },
                {
                    id: "A4",
                    text: "Como você tem dormido? (Você teve problemas para pegar no sono? Acordou no meio da noite? Acordou muito cedo? Dormiu demais?)",
                    sub: "Quantas horas por noite você tem dormido? (Isso é muito diferente do normal?)",
                    criteria: "D. Insônia ou hipersonia quase todos os dias."
                },
                {
                    id: "A5",
                    text: "Você tem estado tão inquieto ou agitado a ponto de não conseguir ficar parado? Ou o contrário, tem se sentido mais lento?",
                    sub: "Você sente como se estivesse se movendo em câmera lenta? Alguém notou isso?",
                    criteria: "E. Agitação ou retardo psicomotor quase todos os dias (observável por outras pessoas, não meramente sensações subjetivas de inquietação ou de estar mais lento)."
                },
                {
                    id: "A6",
                    text: "Como tem estado sua energia?",
                    sub: "Tem se sentido cansado o tempo todo? Teve que se esforçar para fazer as coisas? (Mesmo quando não está fazendo nada?)",
                    criteria: "F. Fadiga ou perda de energia quase todos os dias."
                },
                {
                    id: "A7",
                    text: "Como você tem se sentido em relação a si mesmo? (Você tem se sentido inútil ou culpado?)",
                    sub: "Sobre o que tem se sentido culpado? (Esses sentimentos são excessivos?)",
                    criteria: "G. Sentimentos de inutilidade ou culpa excessiva ou inapropriada (que podem ser delirantes) quase todos os dias (não meramente autorrecriminação ou culpa por estar doente)."
                },
                {
                    id: "A8",
                    text: "Você tem tido dificuldade para pensar ou se concentrar?",
                    sub: "Que tipos de coisas o distraem? Você tem tido dificuldade para tomar decisões?",
                    criteria: "H. Capacidade diminuída para pensar ou se concentrar, ou indecisão, quase todos os dias (por relato subjetivo ou observação feita por outras pessoas)."
                },
                {
                    id: "A9",
                    text: "Você tem tido pensamentos de que seria melhor se estivesse morto ou pensamentos de machucar a si mesmo?",
                    sub: "Você pensou em suicídio? (Você planejou como faria? Você tentou se matar?)",
                    criteria: "I. Pensamentos recorrentes de morte (não somente medo de morrer), ideação suicida recorrente sem um plano específico, uma tentativa de suicídio ou plano específico para cometer suicídio.",
                    inst: "ALERTA: Se positivo, avalie risco imediato."
                },
                {
                    id: "A10",
                    text: "(SUMÁRIO): Os sintomas causaram sofrimento significativo?",
                    sub: "Isso atrapalhou sua vida no trabalho, na escola ou com a família?",
                    criteria: "Critério B: Sofrimento clinicamente significativo ou prejuízo no funcionamento."
                }
            ],
            'C': [
                {
                    id: "C1",
                    text: "Você já teve algum período em que se sentiu muito animado, eufórico, 'no topo do mundo' ou hiperativo?",
                    sub: "Isso era diferente do seu normal? As pessoas comentaram que você estava mais feliz do que o habitual?",
                    criteria: "A. Um período distinto de humor anormal e persistentemente elevado, expansivo ou eufórico."
                },
                {
                    id: "C2",
                    text: "Se você não estava eufórico... houve um período em que você ficou extremamente irritado, bravo ou agressivo?",
                    sub: "Você gritava com as pessoas, iniciava brigas ou discussões?",
                    criteria: "A (Alternativo). Um período distinto de humor anormal e persistentemente irritável."
                },
                { type: 'logic', check: (scores) => (scores['C1']==='+' || scores['C2']==='+') ? 'NEXT' : 'STOP_MODULE' },
                {
                    id: "C3",
                    text: "Durante esse período, como você se sentia em relação a si mesmo? Sentia-se mais autoconfiante do que o habitual?",
                    sub: "Sentia que tinha talentos especiais ou poderes?",
                    criteria: "1. Autoestima inflada ou grandiosidade."
                },
                {
                    id: "C4",
                    text: "Você precisava dormir menos do que o habitual? (Você se sentia descansado com menos horas de sono?)",
                    criteria: "2. Redução da necessidade de sono (p. ex., sente-se repousado com apenas três horas de sono)."
                },
                {
                    id: "C5",
                    text: "Você estava mais falante do que o habitual? (Era difícil para as outras pessoas interromperem você?)",
                    criteria: "3. Mais loquaz que o habitual ou pressão para continuar falando."
                },
                {
                    id: "C6",
                    text: "Você sentia que seus pensamentos estavam correndo? (Sua cabeça estava cheia de ideias?)",
                    criteria: "4. Fuga de ideias ou experiência subjetiva de que os pensamentos estão acelerados."
                },
                {
                    id: "C7",
                    text: "Você se distraía facilmente com coisas ao seu redor?",
                    criteria: "5. Distratibilidade (i.e., a atenção é desviada muito facilmente para estímulos externos insignificantes ou irrelevantes)."
                },
                {
                    id: "C8",
                    text: "Você estava muito mais ativo do que o habitual? (No trabalho, amigos, sexualmente?)",
                    sub: "Você ficava andando de um lado para o outro, sem conseguir sentar?",
                    criteria: "6. Aumento da atividade dirigida a objetivos ou agitação psicomotora."
                },
                {
                    id: "C9",
                    text: "Você fez coisas que poderiam ter causado problemas? (Gastar dinheiro, dirigir rápido, comportamento sexual de risco?)",
                    criteria: "7. Envolvimento excessivo em atividades com elevado potencial para consequências dolorosas."
                }
            ]
        };

        // ============================================================
        // ESTADO DA APLICAÇÃO
        // ============================================================
        let currentModule = 'A';
        let moduleIndex = 0;
        let globalScores = { 'A': {}, 'C': {} }; // Armazena todas as respostas

        // ============================================================
        // FUNÇÕES DE CONTROLE
        // ============================================================

        function switchModule(modId) {
            // Salva estado anterior visualmente
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('nav-' + modId).classList.add('active');

            // Esconde Dashboard, Mostra Entrevista
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('interview-header').style.display = 'flex';
            document.getElementById('interview-area').style.display = 'grid';

            currentModule = modId;
            moduleIndex = 0; // Começa do início do módulo
            updateTitle();
            loadQuestion();
        }

        function updateTitle() {
            const titles = { 'A': 'Módulo A: Depressão', 'C': 'Módulo C: Mania' };
            document.getElementById('module-title').innerText = titles[currentModule];
        }

        function loadQuestion() {
            const questions = database[currentModule];
            
            // Verifica se acabou o módulo
            if (moduleIndex >= questions.length) {
                alert("Módulo " + currentModule + " concluído!");
                return;
            }

            const q = questions[moduleIndex];

            // Lógica de Pulo
            if (q.type === 'logic') {
                const action = q.check(globalScores[currentModule]);
                if (action === 'STOP_MODULE') {
                    alert("Critérios de entrada não atendidos. Encerrando módulo.");
                    // Preenche o resto com '-'
                    finishModuleAsNegative();
                    return;
                } else {
                    moduleIndex++;
                    loadQuestion();
                    return;
                }
            }

            // Atualiza UI
            document.getElementById('q-id').innerText = q.id;
            document.getElementById('q-text').innerText = q.text;
            document.getElementById('c-text').innerText = q.criteria;
            document.getElementById('progress-display').innerText = `Item ${moduleIndex + 1}`;

            const subDiv = document.getElementById('q-sub');
            if (q.sub) { subDiv.style.display = 'block'; subDiv.innerText = q.sub; } 
            else { subDiv.style.display = 'none'; }

            const instDiv = document.getElementById('q-inst');
            if (q.inst) { instDiv.style.display = 'block'; instDiv.innerText = "NOTA: " + q.inst; } 
            else { instDiv.style.display = 'none'; }
        }

        function registerScore(val) {
            const questions = database[currentModule];
            const q = questions[moduleIndex];

            // Salva resposta
            globalScores[currentModule][q.id] = val;

            // Atualiza placar na sidebar
            updateSidebarScore(currentModule);

            moduleIndex++;
            loadQuestion();
        }

        function updateSidebarScore(mod) {
            let count = 0;
            let total = 0;
            const scores = globalScores[mod];

            // Conta apenas sintomas principais (ignorando A10, perguntas lógicas, etc)
            Object.keys(scores).forEach(key => {
                if (scores[key] === '+' && key.length <= 3) count++; // Filtro simples
            });

            // Total aproximado de sintomas
            const max = mod === 'A' ? 9 : 7; 
            document.getElementById('score-' + mod).innerText = `${count}/${max}`;
        }

        function finishModuleAsNegative() {
            // Marca o resto como '-' visualmente no sistema
            // Na prática, apenas paramos de perguntar.
            updateSidebarScore(currentModule);
        }

        function showDashboard() {
            document.getElementById('interview-header').style.display = 'none';
            document.getElementById('interview-area').style.display = 'none';
            document.getElementById('dashboard-view').style.display = 'block';

            const dash = document.getElementById('dashboard-content');
            dash.innerHTML = '';

            // --- RESULTADO DEPRESSÃO ---
            let aScores = globalScores['A'];
            let aCount = 0;
            ['A1','A2','A3','A4','A5','A6','A7','A8','A9'].forEach(k => { if(aScores[k] === '+') aCount++; });
            let depStatus = (aScores['A1']==='+' || aScores['A2']==='+') && aCount >= 5 ? 'Positivo' : 'Negativo';
            let depClass = depStatus === 'Positivo' ? 'positive' : 'negative';

            dash.innerHTML += `
                <div class="result-card ${depClass}">
                    <h3>Episódio Depressivo Maior</h3>
                    <p>Status: <strong>${depStatus}</strong></p>
                    <p>Sintomas: ${aCount}/9</p>
                    <small>Critério A1/A2 presente? ${(aScores['A1']==='+'||aScores['A2']==='+') ? 'Sim' : 'Não'}</small>
                </div>
            `;

            // --- RESULTADO MANIA ---
            let cScores = globalScores['C'];
            let cCount = 0;
            ['C3','C4','C5','C6','C7','C8','C9'].forEach(k => { if(cScores[k] === '+') cCount++; });
            
            // Regra da Mania (Euforia=3, Irritabilidade=4)
            let threshold = (cScores['C1'] === '+') ? 3 : 4;
            let maniaStatus = (cScores['C1']==='+' || cScores['C2']==='+') && cCount >= threshold ? 'Positivo' : 'Negativo';
            let maniaClass = maniaStatus === 'Positivo' ? 'positive' : 'negative';

            dash.innerHTML += `
                <div class="result-card ${maniaClass}">
                    <h3>Episódio Maníaco</h3>
                    <p>Status: <strong>${maniaStatus}</strong></p>
                    <p>Sintomas: ${cCount} (Necessário: ${threshold})</p>
                    <small>Humor: ${cScores['C1']==='+' ? 'Eufórico' : (cScores['C2']==='+' ? 'Irritável' : 'Normal')}</small>
                </div>
            `;
        }

        // Inicializa
        switchModule('A');

    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rastreador de Gatilhos | Terapia do Esquema</title>
    
    <script>
        if(localStorage.getItem('logado') !== 'sim') {
            window.location.href = "../../../login.html"; 
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <link rel="stylesheet" href="../../../assets/style.css">

    <script src="../../../assets/layout.js"></script>

    <style>
        /* Cores específicas desta ferramenta */
        :root {
            --primary-color: #e17055; /* Laranja */
            --success-color: #00b894;
            --trigger-bg: #fff5f2;
            --action-bg: #f0fdf4;
        }
        /* ... Seus estilos específicos dos cards (Copiados do anterior) ... */
        .trigger-list { width: 100%; max-width: 900px; display: flex; flex-direction: column; gap: 20px; margin-bottom: 50px; }
        .trigger-card { background: var(--bg-card); border-radius: var(--border-radius); box-shadow: var(--shadow-soft); border: 1px solid var(--border-color); display: grid; grid-template-columns: 50px 1fr 1fr; overflow: hidden; animation: slideUp 0.4s ease; }
        .card-icon-col { background: #f1f2f6; display: flex; align-items: center; justify-content: center; color: var(--text-muted); font-size: 1.2rem; border-right: 1px solid var(--border-color); }
        .card-col { padding: 20px; position: relative; }
        .col-trigger { border-right: 1px dashed var(--border-color); background: var(--trigger-bg); }
        .col-action { background: var(--action-bg); }
        .card-label { font-size: 0.75rem; text-transform: uppercase; font-weight: 800; margin-bottom: 8px; display: block; opacity: 0.7; color: var(--text-muted); }
        .card-text { font-size: 1rem; line-height: 1.5; font-weight: 600; color: var(--text-main); }
        .text-trigger { color: var(--primary-color); }
        .text-action { color: var(--success-color); }
        .btn-card-delete { position: absolute; top: 10px; right: 10px; background: none; border: none; color: #fab1a0; cursor: pointer; transition: 0.2s; }
        .btn-card-delete:hover { color: var(--danger-color); transform: scale(1.1); }
        
        @media (max-width: 768px) { .trigger-card { grid-template-columns: 1fr; } .card-icon-col { display: none; } .col-trigger { border-right: none; border-bottom: 1px dashed var(--border-color); } }
        #print-header, #print-table { display: none; }
        @media print { .trigger-list, .card-panel, .app-header button { display: none !important; } #print-header { display: block; font-size: 1.5rem; margin-bottom: 20px; font-weight: bold; } #print-table { display: table; width: 100%; border-collapse: collapse; } #print-table th, #print-table td { border: 1px solid #000; padding: 10px; text-align: left; } #print-table th { background: #eee; } }
    </style>
</head>
<body>

    <script>
        // Carrega o Header com os títulos desejados
        carregarHeader("Rastreador de Gatilhos", "Anexo 1: Mapeando situações e respostas");
    </script>

    <div class="card-panel" data-aos="fade-up" style="padding: 15px 30px; display:flex; align-items:center; gap:15px;">
        <i class="fa-solid fa-fingerprint" style="color:var(--primary-color); font-size:1.5rem;"></i>
        <div style="flex:1;">
            <label class="form-label" style="margin-bottom:0; font-size:0.8rem;">ESQUEMA MONITORADO:</label>
            <input type="text" id="schemaInput" class="form-control" style="border:none; border-bottom:2px solid #eee; border-radius:0; padding:5px 0; background:transparent;" value="Abandono / Instabilidade" placeholder="Nome do esquema...">
        </div>
    </div>

    <div class="card-panel" data-aos="fade-up">
        <div style="margin-bottom: 20px;">
            <label class="form-label"><i class="fa-solid fa-location-dot"></i> A Situação (Contexto)</label>
            <input type="text" id="situationInput" class="form-control" placeholder="Ex: Meu parceiro saiu para trabalhar e não mandou mensagem.">
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;" class="responsive-grid">
            <div>
                <label class="form-label" style="color:var(--primary-color)"><i class="fa-solid fa-bomb"></i> O Gatilho Específico</label>
                <textarea id="triggerInput" class="form-control" rows="3" placeholder="O que ativou o esquema? (Ex: A demora em responder...)"></textarea>
            </div>
            <div>
                <label class="form-label" style="color:var(--success-color)"><i class="fa-solid fa-shield-halved"></i> O que fazer (Ação Saudável)</label>
                <textarea id="actionInput" class="form-control" rows="3" placeholder="Como o Adulto Saudável lidaria com isso?"></textarea>
            </div>
        </div>

        <button class="btn-primary" onclick="addCard()">
            <i class="fa-solid fa-plus-circle"></i> Adicionar ao Mapa
        </button>
    </div>

    <div class="trigger-list" id="triggerList">
        </div>

    <div id="print-header">Gatilhos do Esquema: <span id="printSchemaName"></span></div>
    <table id="print-table">
        <thead>
            <tr><th width="35%">Situação</th><th width="30%">Gatilho</th><th width="35%">Ação Saudável</th></tr>
        </thead>
        <tbody id="printBody"></tbody>
    </table>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init();

        function addCard() {
            const situation = document.getElementById('situationInput').value.trim();
            const trigger = document.getElementById('triggerInput').value.trim();
            const action = document.getElementById('actionInput').value.trim();

            if (!situation || !trigger) { alert("Preencha Situação e Gatilho."); return; }

            const list = document.getElementById('triggerList');
            const card = document.createElement('div');
            card.className = 'trigger-card';
            card.innerHTML = `
                <div class="card-icon-col"><i class="fa-solid fa-triangle-exclamation"></i></div>
                <div class="card-col col-trigger">
                    <span class="card-label"><i class="fa-solid fa-map-pin"></i> Situação</span>
                    <div class="card-text" style="margin-bottom:15px;">${situation}</div>
                    <span class="card-label text-trigger"><i class="fa-solid fa-bolt"></i> Gatilho</span>
                    <div class="card-text text-trigger">${trigger}</div>
                </div>
                <div class="card-col col-action">
                    <button class="btn-card-delete" onclick="deleteCard(this)"><i class="fa-solid fa-xmark"></i></button>
                    <span class="card-label text-action"><i class="fa-solid fa-user-shield"></i> Adulto Saudável</span>
                    <div class="card-text">${action || "---"}</div>
                </div>
            `;
            list.prepend(card);
            
            document.getElementById('situationInput').value = '';
            document.getElementById('triggerInput').value = '';
            document.getElementById('actionInput').value = '';
        }

        function deleteCard(btn) {
            if(confirm("Remover?")) btn.closest('.trigger-card').remove();
        }

        function preparePrint() {
            const tbody = document.getElementById('printBody');
            tbody.innerHTML = '';
            document.getElementById('printSchemaName').innerText = document.getElementById('schemaInput').value;
            const cards = document.querySelectorAll('.trigger-card');
            if(cards.length === 0) { alert("Adicione itens."); return; }
            cards.forEach(card => {
                const s = card.querySelector('.col-trigger .card-text:first-of-type').innerText;
                const t = card.querySelector('.col-trigger .text-trigger.card-text').innerText;
                const a = card.querySelector('.col-action .card-text').innerText;
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${s}</td><td>${t}</td><td>${a}</td>`;
                tbody.appendChild(tr);
            });
            window.print();
        }

        // CARREGA O FOOTER NO FINAL
        carregarFooter();
    </script>

</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroTAG 3D Interativo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { margin: 0; overflow: hidden; background: #0f172a; font-family: sans-serif; }
        
        #ui-container {
            position: absolute; top: 0; left: 0; width: 300px; height: 100vh;
            background: rgba(15, 23, 42, 0.95); color: white;
            padding: 20px; box-sizing: border-box; border-right: 1px solid #334155;
            display: flex; flex-direction: column;
        }

        h2 { color: #38bdf8; margin-top: 0; text-transform: uppercase; font-size: 1.2rem; }
        p { color: #94a3b8; line-height: 1.5; font-size: 0.95rem; }
        
        .info-box {
            margin-top: auto;
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;
        }

        #loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #38bdf8; font-size: 1.5rem; font-weight: bold; pointer-events: none;
            transition: opacity 0.5s;
        }

        #back-btn {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255,255,255,0.1); color: white; border: 1px solid white;
            padding: 10px 20px; border-radius: 30px; cursor: pointer; text-decoration: none;
            font-weight: bold; transition: 0.2s;
        }
        #back-btn:hover { background: white; color: black; }

        /* Label flutuante */
        #label {
            position: absolute; pointer-events: none; 
            background: black; color: white; padding: 5px 10px; 
            border-radius: 4px; display: none; transform: translate(-50%, -150%);
        }
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

    <div id="ui-container">
        <div>
            <h2><i class="fa-solid fa-cube"></i> NeuroTAG 3D</h2>
            <p>Este modelo representa as estruturas envolvidas na ansiedade.</p>
            <hr style="border-color:#334155">
        </div>

        <div id="dynamic-info">
            <h3 style="color:#fff">Instruções:</h3>
            <p>1. <strong>Arraste</strong> para girar o cérebro.</p>
            <p>2. <strong>Clique</strong> nas esferas coloridas dentro dele para ver a explicação.</p>
        </div>

        <div class="info-box">
            <i class="fa-solid fa-mouse"></i> Interativo
        </div>
    </div>

    <div id="loading">Carregando Modelo...</div>
    <div id="label"></div>
    <a href="psicoeducacao-tag.html" id="back-btn">Voltar</a>

    <script>
        // --- CONFIGURAÇÃO THREE.JS ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0f172a);
        scene.fog = new THREE.FogExp2(0x0f172a, 0.03);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0, 8);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // Luzes
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0x38bdf8, 1, 20);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);

        // --- OBJETOS ---
        const group = new THREE.Group();
        scene.add(group);

        // 1. Cérebro "Fantasma" (Vidro)
        const geometry = new THREE.IcosahedronGeometry(2.5, 1);
        const material = new THREE.MeshPhongMaterial({
            color: 0x94a3b8,
            transparent: true,
            opacity: 0.15,
            side: THREE.DoubleSide,
            shininess: 100
        });
        const brainMesh = new THREE.Mesh(geometry, material);
        brainMesh.scale.set(0.8, 1, 1.2); // Formato oval
        group.add(brainMesh);

        // Wireframe (linhas tecnológicas)
        const wireframe = new THREE.WireframeGeometry(geometry);
        const line = new THREE.LineSegments(wireframe);
        line.material.depthTest = false;
        line.material.opacity = 0.05;
        line.material.transparent = true;
        line.scale.set(0.8, 1, 1.2);
        group.add(line);

        // 2. Órgãos Internos (Esferas Clicáveis)
        const interactables = [];

        function createOrgan(name, color, pos, size) {
            const geo = new THREE.SphereGeometry(size, 32, 32);
            const mat = new THREE.MeshStandardMaterial({ 
                color: color, 
                emissive: color,
                emissiveIntensity: 0.5 
            });
            const mesh = new THREE.Mesh(geo, mat);
            mesh.position.set(pos.x, pos.y, pos.z);
            mesh.userData = { name: name };
            group.add(mesh);
            interactables.push(mesh);
            
            // Luz interna da esfera
            const light = new THREE.PointLight(color, 1, 2);
            mesh.add(light);
        }

        // Criando as partes
        createOrgan("Córtex Pré-Frontal", 0x38bdf8, {x:0, y:0.8, z:1.5}, 0.4); // Azul (Testa)
        createOrgan("Amígdala", 0xff5252, {x:0, y:-0.5, z:0}, 0.3); // Vermelho (Centro)
        createOrgan("Hipocampo", 0x4ade80, {x:0.8, y:-0.5, z:-0.5}, 0.25); // Verde (Memória)

        document.getElementById('loading').style.display = 'none';

        // --- INTERAÇÃO ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        const label = document.getElementById('label');
        const infoDiv = document.getElementById('dynamic-info');

        const descriptions = {
            "Córtex Pré-Frontal": "<h3 style='color:#38bdf8'>O Chefe (Racional)</h3><p>Planeja e acalma. No TAG, ele perde a conexão com o alarme e não consegue dizer 'está tudo bem'.</p>",
            "Amígdala": "<h3 style='color:#ff5252'>O Alarme (Medo)</h3><p>Hiperativa no TAG. Ela dispara o alerta de perigo (adrenalina) mesmo sem motivo real.</p>",
            "Hipocampo": "<h3 style='color:#4ade80'>A Memória</h3><p>Armazena contexto. O estresse pode prejudicá-lo, fazendo você confundir lembranças ruins com perigos atuais.</p>"
        };

        function onMouseClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactables);

            if (intersects.length > 0) {
                const obj = intersects[0].object;
                const name = obj.userData.name;
                
                // Efeito visual
                obj.scale.set(1.5, 1.5, 1.5);
                setTimeout(() => obj.scale.set(1, 1, 1), 200);

                // Atualizar texto
                infoDiv.innerHTML = descriptions[name];
            }
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactables);

            if (intersects.length > 0) {
                document.body.style.cursor = 'pointer';
                const name = intersects[0].object.userData.name;
                label.style.display = 'block';
                label.style.left = event.clientX + 'px';
                label.style.top = event.clientY + 'px';
                label.innerText = name;
            } else {
                document.body.style.cursor = 'default';
                label.style.display = 'none';
            }
        }

        window.addEventListener('click', onMouseClick);
        window.addEventListener('mousemove', onMouseMove);
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Animação
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            group.rotation.y += 0.001; // Rotação lenta automática
            renderer.render(scene, camera);
        }
        animate();

    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ca√ßa-Sintomas DSM-5 | Bruno de Souza</title>
    
    <script>
        if(localStorage.getItem('logado') !== 'sim') {
            window.location.href = "../../login.html";
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        :root {
            --bg-color: #f0f8ff;
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #e67e22;
            --text: #2d3436;
            --selected: #fab1a0;
            --found: #55efc4;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#dfe6e9 2px, transparent 2px);
            background-size: 20px 20px;
            margin: 0; padding: 20px;
            color: var(--text);
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            user-select: none;
        }

        /* --- HEADER --- */
        header {
            text-align: center; margin-bottom: 20px;
            background: white; padding: 20px 40px;
            border-radius: 20px; border: 3px dashed var(--primary);
            box-shadow: 8px 8px 0 rgba(0,0,0,0.05);
            max-width: 900px; width: 100%; position: relative;
        }

        header h1 { color: var(--primary); margin: 0; font-weight: 800; font-size: 1.8rem; }
        .subtitle { color: #636e72; font-weight: 600; margin-top: 5px; }

        .btn-print {
            position: absolute; top: 20px; right: 20px;
            background: none; border: 2px solid var(--primary); color: var(--primary);
            padding: 8px 15px; border-radius: 20px; font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        .btn-print:hover { background: var(--primary); color: white; }

        /* --- CONTROLES --- */
        .controls-area {
            background: white; padding: 20px; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 20px;
            display: flex; gap: 15px; align-items: center; justify-content: center; flex-wrap: wrap;
            width: 100%; max-width: 1000px;
        }

        select {
            padding: 12px 20px; border-radius: 10px; border: 2px solid #dfe6e9;
            font-family: inherit; font-size: 1rem; font-weight: bold; color: var(--text);
            cursor: pointer; min-width: 300px; flex: 1;
        }

        .btn-new {
            background: var(--primary); color: white; border: none; padding: 12px 25px;
            border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        .btn-new:hover { background: var(--secondary); transform: scale(1.05); }

        /* --- JOGO --- */
        .game-container {
            display: flex; flex-direction: column; align-items: center; gap: 30px;
            width: 100%; max-width: 900px;
        }

        /* GRID */
        .word-grid {
            display: grid; 
            grid-template-columns: repeat(14, 1fr); /* Grid maior */
            gap: 4px; 
            background: white; padding: 15px; border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            touch-action: manipulation;
        }

        .letter-cell {
            width: 32px; height: 32px; 
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 1.1rem; text-transform: uppercase;
            border-radius: 4px; cursor: pointer; transition: 0.2s;
            background: #f8f9fa; color: #2d3436;
        }

        .letter-cell:hover { background: #dfe6e9; }
        .letter-cell.selected { background: var(--selected); color: #d35400; transform: scale(1.1); }
        .letter-cell.found { background: var(--found); color: #006266; animation: popIn 0.3s; }

        /* LISTA */
        .words-list {
            background: white; padding: 20px; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); width: 100%;
            text-align: center;
        }
        .words-list h3 { margin: 0 0 15px 0; color: var(--primary); font-size: 1.1rem; }
        
        .words-wrapper {
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
        }

        .word-item {
            background: #f1f2f6; padding: 6px 12px; border-radius: 20px;
            font-weight: 600; font-size: 0.85rem; color: #636e72; transition: 0.3s;
        }
        .word-item.found {
            background: var(--found); color: #006266; text-decoration: line-through; opacity: 0.6;
        }

        /* --- VIT√ìRIA --- */
        .victory-msg {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 40px; border-radius: 30px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); z-index: 100; display: none;
            border: 5px solid var(--found); animation: popUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .victory-msg h2 { color: var(--found); font-size: 2.5rem; margin: 0 0 10px 0; }
        .victory-msg p { font-size: 1.2rem; margin-bottom: 20px; }

        @keyframes popIn { from { transform: scale(0.5); } to { transform: scale(1); } }
        @keyframes popUp { from { transform: translate(-50%, 0); opacity: 0; } to { transform: translate(-50%, -50%); opacity: 1; } }

        @media (max-width: 600px) {
            .word-grid { gap: 2px; padding: 5px; grid-template-columns: repeat(12, 1fr); }
            .letter-cell { width: 24px; height: 24px; font-size: 0.8rem; }
            .btn-print span { display: none; }
        }

        @media print {
            body { background: white; }
            header button, .btn-back-home, .btn-new { display: none !important; }
            .controls-area { border: none; box-shadow: none; }
            .word-grid { box-shadow: none; border: 1px solid #ccc; }
        }
    </style>
</head>
<body>

    <header data-aos="fade-down">
        <button class="btn-print" onclick="window.print()"><i class="fa-solid fa-print"></i> <span>Imprimir</span></button>
        <h1>Ca√ßa-Palavras DSM-5</h1>
        <div class="subtitle">Psicopatologia e Diagn√≥stico</div>
    </header>

    <div class="controls-area" data-aos="fade-up">
        <label style="font-weight:bold; color:var(--text);"><i class="fa-solid fa-book-medical"></i> Categoria:</label>
        <select id="categorySelect" onchange="startGame()">
            <option value="neuro">1. Neurodesenvolvimento (TDAH/TEA)</option>
            <option value="esquizofrenia">2. Espectro da Esquizofrenia</option>
            <option value="bipolar">3. Bipolar & Humor</option>
            <option value="ansiedade">4. Transtornos de Ansiedade</option>
            <option value="toc">5. TOC & Relacionados</option>
            <option value="trauma">6. Trauma & Estresse (TEPT)</option>
            <option value="alimentar">7. Transtornos Alimentares</option>
            <option value="sono">8. Sono-Vig√≠lia</option>
            <option value="personalidade">9. Personalidade (Clusters)</option>
            <option value="substancias">10. Uso de Subst√¢ncias</option>
            <option value="neurocog">11. Neurocognitivos (Dem√™ncias)</option>
            <option value="disruptivo">12. Disruptivos & Conduta</option>
        </select>
        <button class="btn-new" onclick="startGame()"><i class="fa-solid fa-rotate"></i> Gerar Novo</button>
    </div>

    <div class="game-container" data-aos="zoom-in">
        <div class="word-grid" id="grid"></div>
        <div class="words-list">
            <h3>Encontre os Termos:</h3>
            <div class="words-wrapper" id="wordList"></div>
        </div>
    </div>

    <div class="victory-msg" id="victoryModal">
        <i class="fa-solid fa-trophy" style="font-size: 4rem; color: #f1c40f; margin-bottom: 20px;"></i>
        <h2>Excelente!</h2>
        <p>Voc√™ dominou este tema!</p>
        <button class="btn-new" onclick="startGame()">Jogar Outra Categoria</button>
    </div>

    <center>
        <a href="../listaferramentas.html" style="display:inline-block; margin-top:40px; color:#b2bec3; text-decoration:none; font-weight:600;" class="btn-back-home">
            <i class="fa-solid fa-arrow-left"></i> Voltar
        </a>
    </center>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        AOS.init();

        // üìö BANCO DE DADOS COMPLETO DSM-5
        const database = {
            neuro: ["AUTISMO", "HIPERFOCO", "ECOLALIA", "DESATENCAO", "IMPULSIVIDADE", "TDAH", "DISLEXIA", "TIC", "ESTEREO", "GENETICA", "MOTOR", "ATRASO"],
            esquizofrenia: ["DELIRIO", "ALUCINACAO", "CATATONIA", "PARANOIA", "SURTO", "APATIA", "NEGATIVOS", "PSICOSE", "REALIDADE", "AFETO", "DISCURSO", "LOGICA"],
            bipolar: ["MANIA", "EUFORIA", "DEPRESSAO", "CICLOTIMIA", "HIPOMANIA", "LITIO", "OSCILACAO", "MISTO", "IRRITACAO", "ENERGIA", "SONO", "RISCO"],
            ansiedade: ["PANICO", "AGORAFOBIA", "GENERALIZADA", "SOCIAL", "SEPARACAO", "MUTISMO", "FOBIA", "MEDO", "EVITACAO", "TAQUICARDIA", "FUTURO", "TREMOR"],
            toc: ["OBSESSAO", "COMPULSAO", "RITUAL", "SIMETRIA", "LIMPEZA", "ACUMULACAO", "DISMORFICO", "TRICOTILO", "DUVIDA", "REPETICAO", "CONTROLE", "PELE"],
            trauma: ["TEPT", "FLASHBACK", "PESADELO", "GATILHO", "ESTRESSE", "APEGO", "DISSOCIACAO", "ALERTA", "MEMORIA", "TRAUMA", "EVITACAO", "AGUDO"],
            alimentar: ["ANOREXIA", "BULIMIA", "COMPULSAO", "PICA", "RUMINACAO", "RESTRITIVO", "IMAGEM", "PESO", "PURGACAO", "CONTROLE", "CALORIA", "MEDO"],
            sono: ["INSONIA", "APNEIA", "NARCOLEPSIA", "TERROR", "SONAMBULO", "HIPER", "CIRCADIANO", "REM", "PIERNAS", "CANSACO", "VIGILIA", "HIGIENE"],
            personalidade: ["BORDERLINE", "NARCISISTA", "ANTISSOCIAL", "PARANOIDE", "ESQUIZOIDE", "HISTRIONICA", "EVITATIVA", "DEPENDENTE", "OBSESSIVA", "RIGIDEZ", "DRAMATICO", "EMPATIA"],
            substancias: ["ALCOOL", "CANNABIS", "OPIOIDE", "ABSTINENCIA", "TOLERANCIA", "CRAVING", "RECAIDA", "JOGO", "VICIO", "DOPAMINA", "INTOXICA", "SEDATIVO"],
            neurocog: ["ALZHEIMER", "DEMENCIA", "DELIRIUM", "MEMORIA", "AFASIA", "AGNOSIA", "VASCULAR", "LEWY", "PARKINSON", "EXECUCAO", "DECLINIO", "IDADE"],
            disruptivo: ["OPOSITIVO", "DESAFIADOR", "CONDUTA", "EXPLOSIVO", "INTERMITENTE", "RAIVA", "AGRESSAO", "FURTO", "PIROMANIA", "CLEPTOMANIA", "REGRAS", "IMPULSO"]
        };

        const GRID_SIZE = 14; // Grid 14x14 para caber palavras maiores
        let grid = [];
        let placedWords = [];
        let firstSelection = null;

        function startGame() {
            document.getElementById('victoryModal').style.display = 'none';
            document.getElementById('grid').innerHTML = '';
            document.getElementById('wordList').innerHTML = '';
            firstSelection = null;
            
            const category = document.getElementById('categorySelect').value;
            // Pega 10 palavras aleat√≥rias da categoria para n√£o poluir demais
            const allWords = [...database[category]];
            const words = allWords.sort(() => 0.5 - Math.random()).slice(0, 10);

            grid = Array(GRID_SIZE).fill(null).map(() => Array(GRID_SIZE).fill(''));
            placedWords = [];

            // Tenta colocar palavras
            words.forEach(word => placeWordInGrid(word));

            fillEmptySpaces();
            renderGrid();
            renderList();
        }

        function placeWordInGrid(word) {
            let placed = false;
            let attempts = 0;
            // Dire√ß√µes: Horizontal, Vertical, Diagonal (\), Diagonal (/)
            const directions = [
                { dr: 0, dc: 1 }, { dr: 1, dc: 0 }, 
                { dr: 1, dc: 1 }, { dr: 1, dc: -1 }
            ];

            while (!placed && attempts < 100) {
                const dir = directions[Math.floor(Math.random() * directions.length)];
                const row = Math.floor(Math.random() * GRID_SIZE);
                const col = Math.floor(Math.random() * GRID_SIZE);

                if (canPlace(word, row, col, dir)) {
                    for (let i = 0; i < word.length; i++) {
                        grid[row + i * dir.dr][col + i * dir.dc] = word[i];
                    }
                    placedWords.push({ word, found: false });
                    placed = true;
                }
                attempts++;
            }
        }

        function canPlace(word, row, col, dir) {
            if (row + (word.length - 1) * dir.dr >= GRID_SIZE || row + (word.length - 1) * dir.dr < 0) return false;
            if (col + (word.length - 1) * dir.dc >= GRID_SIZE || col + (word.length - 1) * dir.dc < 0) return false;

            for (let i = 0; i < word.length; i++) {
                const cell = grid[row + i * dir.dr][col + i * dir.dc];
                if (cell !== '' && cell !== word[i]) return false;
            }
            return true;
        }

        function fillEmptySpaces() {
            const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    if (grid[r][c] === '') grid[r][c] = letters[Math.floor(Math.random() * letters.length)];
                }
            }
        }

        function renderGrid() {
            const gridEl = document.getElementById('grid');
            gridEl.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 1fr)`;
            
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'letter-cell';
                    cell.innerText = grid[r][c];
                    cell.dataset.r = r;
                    cell.dataset.c = c;
                    cell.onclick = () => handleCellClick(cell, r, c);
                    gridEl.appendChild(cell);
                }
            }
        }

        function renderList() {
            const listEl = document.getElementById('wordList');
            placedWords.forEach(obj => {
                const item = document.createElement('div');
                item.className = 'word-item';
                item.id = 'word-' + obj.word;
                item.innerText = obj.word;
                listEl.appendChild(item);
            });
        }

        function handleCellClick(el, r, c) {
            if (el.classList.contains('found')) return;

            if (!firstSelection) {
                clearSelection();
                firstSelection = { r, c, el };
                el.classList.add('selected');
            } else {
                checkWord(firstSelection, { r, c, el });
                firstSelection = null;
            }
        }

        function clearSelection() {
            document.querySelectorAll('.letter-cell.selected').forEach(el => el.classList.remove('selected'));
        }

        function checkWord(start, end) {
            const dr = end.r - start.r;
            const dc = end.c - start.c;
            const length = Math.max(Math.abs(dr), Math.abs(dc));
            
            const stepR = dr === 0 ? 0 : dr / length;
            const stepC = dc === 0 ? 0 : dc / length;

            // Valida se √© linha reta
            if (dr !== 0 && dc !== 0 && Math.abs(dr) !== Math.abs(dc)) {
                clearSelection();
                return;
            }

            let formedWord = "";
            let pathCells = [];

            for (let i = 0; i <= length; i++) {
                const r = start.r + (i * stepR);
                const c = start.c + (i * stepC);
                // Prote√ß√£o contra float
                const finalR = Math.round(r);
                const finalC = Math.round(c);
                
                const cell = document.querySelector(`.letter-cell[data-r="${finalR}"][data-c="${finalC}"]`);
                if (cell) {
                    formedWord += cell.innerText;
                    pathCells.push(cell);
                }
            }

            const reversedWord = formedWord.split('').reverse().join('');
            const matchIndex = placedWords.findIndex(w => (w.word === formedWord || w.word === reversedWord) && !w.found);

            if (matchIndex !== -1) {
                const foundWordStr = placedWords[matchIndex].word;
                placedWords[matchIndex].found = true;
                
                pathCells.forEach(cell => {
                    cell.classList.remove('selected');
                    cell.classList.add('found');
                });
                
                document.getElementById('word-' + foundWordStr).classList.add('found');
                checkVictory();
            } else {
                pathCells.forEach(cell => cell.classList.add('selected'));
                setTimeout(clearSelection, 500);
            }
        }

        function checkVictory() {
            if (placedWords.every(w => w.found)) {
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 }
                });
                setTimeout(() => { document.getElementById('victoryModal').style.display = 'block'; }, 800);
            }
        }

        startGame();
    </script>

</body>
</html>

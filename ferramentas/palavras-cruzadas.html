<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cruzadinha DSM-5 & TCC | Bruno de Souza</title>
    
    <script>
        if(localStorage.getItem('logado') !== 'sim') {
            window.location.href = "../../login.html";
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- SYSTEM VARS --- */
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #e67e22; /* Laranja Energ√©tico */
            --bg-body: #ecf0f1;
            --card-bg: #ffffff;
            --text-main: #2c3e50;
            --text-light: #7f8c8d;
            --cell-size: 36px;
            --cell-bg: #fff;
            --cell-border: #bdc3c7;
            --correct-bg: #27ae60;
            --correct-text: #fff;
            --wrong-bg: #c0392b;
            --wrong-text: #fff;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0; padding: 20px;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        /* --- HEADER --- */
        header {
            background: var(--card-bg); padding: 20px 40px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: center;
            width: 100%; max-width: 1200px; margin-bottom: 30px;
            border-bottom: 5px solid var(--accent); position: relative;
        }

        header h1 { margin: 0; color: var(--primary); font-size: 2rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
        .subtitle { color: var(--text-light); font-weight: 600; margin-top: 5px; font-size: 1rem; }

        .btn-print {
            position: absolute; top: 25px; right: 30px;
            background: transparent; border: 2px solid var(--primary); color: var(--primary);
            padding: 8px 20px; border-radius: 30px; font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        .btn-print:hover { background: var(--primary); color: white; }

        /* --- CONTROL PANEL --- */
        .control-panel {
            width: 100%; max-width: 1200px; background: var(--card-bg);
            padding: 20px; border-radius: 15px; margin-bottom: 30px;
            display: flex; gap: 20px; align-items: center; flex-wrap: wrap;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03);
        }

        .select-wrapper { flex: 1; min-width: 300px; position: relative; }
        select {
            width: 100%; padding: 15px 20px; border-radius: 10px; border: 2px solid #dfe6e9;
            font-family: inherit; font-size: 1rem; font-weight: 700; color: var(--text-main);
            background: white; cursor: pointer; appearance: none;
        }
        /* Icone da seta customizado via CSS pure */
        .select-wrapper::after {
            content: '‚ñº'; font-size: 0.8rem; color: var(--primary);
            position: absolute; right: 20px; top: 50%; transform: translateY(-50%); pointer-events: none;
        }

        .btn-game {
            padding: 12px 25px; border-radius: 10px; border: none; cursor: pointer;
            font-weight: 800; font-size: 0.95rem; color: white; display: flex; align-items: center; gap: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-game:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .btn-check { background: #27ae60; }
        .btn-answers { background: #f39c12; }
        .btn-reset { background: #95a5a6; }
        .btn-new { background: var(--primary); }

        /* --- GAME BOARD LAYOUT --- */
        .game-layout {
            display: grid; grid-template-columns: 2fr 1fr; gap: 30px;
            width: 100%; max-width: 1300px;
        }

        /* --- THE GRID --- */
        .grid-wrapper {
            background: var(--primary); padding: 15px; border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: auto; display: flex; justify-content: center; align-items: center;
            min-height: 500px; position: relative;
        }

        #crosswordGrid {
            display: grid; gap: 2px;
            /* Grid din√¢mico definido via JS */
        }

        .cell {
            width: var(--cell-size); height: var(--cell-size);
            background: transparent; position: relative;
        }

        .cell.active { background: var(--cell-bg); border-radius: 4px; }

        .cell input {
            width: 100%; height: 100%; border: none; text-align: center;
            font-family: 'Quicksand', sans-serif; font-weight: 800; font-size: 1.1rem;
            text-transform: uppercase; color: var(--text-main); background: transparent;
            padding: 0; outline: none; cursor: pointer; border-radius: 4px;
        }
        
        .cell input:focus { background: #dff9fb; box-shadow: inset 0 0 0 2px var(--accent); }
        
        .cell.correct input { background: var(--correct-bg); color: var(--correct-text); }
        .cell.wrong input { background: var(--wrong-bg); color: var(--wrong-text); animation: shake 0.4s; }

        .cell-num {
            position: absolute; top: 1px; left: 2px; font-size: 9px;
            color: var(--primary); font-weight: 800; pointer-events: none;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(44, 62, 80, 0.9); z-index: 10; border-radius: 15px;
            display: none; flex-direction: column; justify-content: center; align-items: center; color: white;
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid var(--accent); border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 15px;
        }

        /* --- CLUES PANEL --- */
        .clues-panel {
            background: white; border-radius: 15px; padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); height: 600px;
            display: flex; flex-direction: column;
        }

        .clues-tabs { display: flex; border-bottom: 2px solid #ecf0f1; margin-bottom: 15px; }
        .tab-btn {
            flex: 1; padding: 10px; border: none; background: none; cursor: pointer;
            font-weight: 800; color: var(--text-light); border-bottom: 3px solid transparent;
            transition: 0.3s;
        }
        .tab-btn.active { color: var(--primary); border-color: var(--primary); }

        .clues-content { flex: 1; overflow-y: auto; padding-right: 5px; }
        
        /* Scrollbar */
        .clues-content::-webkit-scrollbar { width: 6px; }
        .clues-content::-webkit-scrollbar-track { background: #f1f1f1; }
        .clues-content::-webkit-scrollbar-thumb { background: #bdc3c7; border-radius: 10px; }

        .clue-item {
            padding: 8px 10px; border-radius: 8px; margin-bottom: 8px; cursor: pointer;
            font-size: 0.9rem; line-height: 1.4; color: var(--text-main); transition: 0.2s;
            border-left: 3px solid transparent;
        }
        .clue-item:hover { background: #f7f9fa; border-left-color: var(--accent); }
        .clue-item.highlight { background: #e0f2f1; border-left-color: var(--correct-bg); }
        .clue-item strong { color: var(--primary); margin-right: 5px; }

        /* --- ANSWERS MODAL --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(5px);
            z-index: 1000; display: none; align-items: center; justify-content: center;
        }
        .modal-box {
            background: white; width: 90%; max-width: 800px; height: 80vh;
            border-radius: 20px; padding: 30px; box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            display: flex; flex-direction: column; animation: slideUp 0.3s ease;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-light); }
        
        .answers-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;
            overflow-y: auto; flex: 1; padding: 10px;
        }
        .answer-card {
            background: #f8f9fa; padding: 15px; border-radius: 10px; border: 1px solid #eee;
        }
        .ans-term { font-weight: 800; color: var(--correct-bg); display: block; margin-bottom: 5px; }
        .ans-def { font-size: 0.85rem; color: var(--text-light); }

        /* Keyframes */
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(5px); } 75% { transform: translateX(-5px); } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Responsive */
        @media (max-width: 900px) {
            .game-layout { grid-template-columns: 1fr; }
            .grid-wrapper { min-height: 400px; }
            .clues-panel { height: 400px; }
            .btn-print span { display: none; }
        }

        /* Print */
        @media print {
            header button, .control-panel, .btn-back-home { display: none !important; }
            .game-layout { display: block; }
            .grid-wrapper { box-shadow: none; padding: 0; background: transparent; }
            .cell { border: 1px solid #000; }
            .cell input { color: transparent !important; } /* Esconde respostas */
            .clues-panel { box-shadow: none; height: auto; margin-top: 30px; }
            .clues-content { overflow: visible; }
        }
    </style>
</head>
<body>

    <header>
        <button class="btn-print" onclick="window.print()"><i class="fa-solid fa-print"></i> <span>Imprimir</span></button>
        <h1>Psico-Cruzada DSM-5</h1>
        <div class="subtitle">Neurodesenvolvimento, Psicopatologia & Terapia Cognitiva</div>
    </header>

    <div class="control-panel">
        <div class="select-wrapper">
            <select id="categorySelect" onchange="generateGame()">
                <option value="neuro">1. Neurodesenvolvimento (TDAH/TEA)</option>
                <option value="psicotico">2. Espectro da Esquizofrenia</option>
                <option value="bipolar">3. Bipolar & Humor</option>
                <option value="ansiedade">4. Transtornos de Ansiedade</option>
                <option value="toc">5. TOC & Relacionados</option>
                <option value="trauma">6. Trauma & Estresse (TEPT)</option>
                <option value="alimentar">7. Transtornos Alimentares</option>
                <option value="sono">8. Sono-Vig√≠lia</option>
                <option value="personalidade">9. Personalidade (Clusters A, B, C)</option>
                <option value="substancias">10. Uso de Subst√¢ncias</option>
                <option value="neurocog">11. Neurocognitivos (Dem√™ncias)</option>
                <option value="burnout">12. Burnout & Trabalho</option>
                <option value="tcc">13. Conceitos TCC (B√¥nus)</option>
            </select>
        </div>

        <button class="btn-game btn-new" onclick="generateGame()">
            <i class="fa-solid fa-shuffle"></i> Novo Jogo
        </button>
        
        <button class="btn-game btn-check" onclick="checkGame()">
            <i class="fa-solid fa-check"></i> Verificar
        </button>
        
        <button class="btn-game btn-answers" onclick="showAnswers()">
            <i class="fa-solid fa-key"></i> Gabarito
        </button>
        
        <button class="btn-game btn-reset" onclick="resetGrid()">
            <i class="fa-solid fa-eraser"></i> Limpar
        </button>
    </div>

    <div class="game-layout">
        
        <div class="grid-wrapper">
            <div class="loading-overlay" id="loading">
                <div class="spinner"></div>
                <span>Gerando Layout...</span>
            </div>
            <div id="crosswordGrid"></div>
        </div>

        <div class="clues-panel">
            <div class="clues-tabs">
                <button class="tab-btn active" onclick="switchTab('H')">Horizontais</button>
                <button class="tab-btn" onclick="switchTab('V')">Verticais</button>
            </div>
            <div class="clues-content">
                <div id="listH"></div>
                <div id="listV" style="display:none;"></div>
            </div>
        </div>

    </div>

    <div class="modal" id="modalAnswers">
        <div class="modal-box">
            <div class="modal-header">
                <h2 style="margin:0; color:var(--primary);">Gabarito Completo</h2>
                <button class="modal-close" onclick="closeModal()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="answers-grid" id="modalList"></div>
        </div>
    </div>

    <center>
        <a href="../listaferramentas.html" style="display:inline-block; margin-top:40px; color:#b2bec3; text-decoration:none; font-weight:600;" class="btn-back-home">
            <i class="fa-solid fa-arrow-left"></i> Voltar
        </a>
    </center>

    <script>
        // ============================================
        // üìö BANCO DE DADOS (DATABASE)
        // ============================================
        const wordDatabase = {
            neuro: [
                {t:"HIPERFOCO", d:"Estado de concentra√ß√£o intensa comum no TDAH."},
                {t:"ECOLALIA", d:"Repeti√ß√£o involunt√°ria de palavras (comum no TEA)."},
                {t:"DESATENCAO", d:"Dificuldade em manter o foco em tarefas repetitivas."},
                {t:"IMPULSIVIDADE", d:"Agir sem pensar nas consequ√™ncias."},
                {t:"SENSORIAL", d:"Hipersensibilidade a luz, som ou toque no autismo."},
                {t:"ESTEREOTIPIA", d:"Movimentos repetitivos (ex: balan√ßar as m√£os)."},
                {t:"EXECUTIVAS", d:"Fun√ß√µes mentais prejudicadas no TDAH (planejamento)."},
                {t:"DOPAMINA", d:"Neurotransmissor associado ao sistema de recompensa."},
                {t:"GENETICA", d:"Fator de risco biol√≥gico predominante nestes transtornos."},
                {t:"ROTINA", d:"Necessidade de rigidez e previs√£o no TEA."}
            ],
            psicotico: [
                {t:"DELIRIO", d:"Cren√ßa fixa e falsa que n√£o muda diante de evid√™ncias."},
                {t:"ALUCINACAO", d:"Percep√ß√£o sensorial sem est√≠mulo externo (ex: ouvir vozes)."},
                {t:"CATATONIA", d:"Imobilidade motora ou agita√ß√£o excessiva."},
                {t:"NEGATIVOS", d:"Sintomas como apatia e falta de afeto na esquizofrenia."},
                {t:"PARANOIA", d:"Sentimento de persegui√ß√£o constante."},
                {t:"DESORGANIZADO", d:"Tipo de pensamento ou fala sem nexo."},
                {t:"PRODROMO", d:"Fase inicial com sintomas leves antes do surto."},
                {t:"SURTO", d:"Epis√≥dio agudo de desconex√£o com a realidade."},
                {t:"AFETO", d:"Pode estar embotado ou plano nestes transtornos."},
                {t:"REALIDADE", d:"O que √© perdido durante a psicose."}
            ],
            bipolar: [
                {t:"MANIA", d:"Fase de euforia, energia excessiva e grandiosidade."},
                {t:"DEPRESSAO", d:"Fase de baixa energia e tristeza profunda."},
                {t:"CICLOTIMIA", d:"Forma mais leve e cr√¥nica de oscila√ß√£o de humor."},
                {t:"LITIO", d:"Medicamento estabilizador de humor cl√°ssico."},
                {t:"MISTO", d:"Epis√≥dio com sintomas de mania e depress√£o simult√¢neos."},
                {t:"HIPOMANIA", d:"Mania menos severa, sem preju√≠zo social grave."},
                {t:"SONO", d:"Necessidade reduzida durante a fase man√≠aca."},
                {t:"COMPRAS", d:"Comportamento de risco comum na euforia."},
                {t:"OSCILACAO", d:"Mudan√ßa entre polos de humor."},
                {t:"SUICIDIO", d:"Risco elevado que requer aten√ß√£o constante."}
            ],
            ansiedade: [
                {t:"GENERALIZADA", d:"TAG: Preocupa√ß√£o excessiva com tudo."},
                {t:"PANICO", d:"Ataque s√∫bito de medo intenso e sintomas f√≠sicos."},
                {t:"AGORAFOBIA", d:"Medo de lugares onde a fuga seria dif√≠cil."},
                {t:"SOCIAL", d:"Medo intenso de julgamento em situa√ß√µes p√∫blicas."},
                {t:"SEPARACAO", d:"Ansiedade ao afastar-se de figuras de apego."},
                {t:"MUTISMO", d:"Incapacidade de falar em situa√ß√µes espec√≠ficas."},
                {t:"EVITACAO", d:"Comportamento que mant√©m a ansiedade a longo prazo."},
                {t:"TAQUICARDIA", d:"Sintoma f√≠sico: cora√ß√£o acelerado."},
                {t:"CATASTROFE", d:"Pensar que o pior cen√°rio vai acontecer."},
                {t:"FUTURO", d:"Tempo verbal onde a ansiedade reside."}
            ],
            toc: [
                {t:"OBSESSAO", d:"Pensamento intrusivo, recorrente e indesejado."},
                {t:"COMPULSAO", d:"Comportamento repetitivo para aliviar a ansiedade."},
                {t:"RITUAL", d:"Sequ√™ncia r√≠gida de a√ß√µes (ex: lavar m√£os)."},
                {t:"DUVIDA", d:"Sentimento constante de incerteza ('Fechei a porta?')."},
                {t:"SIMETRIA", d:"Necessidade de alinhar objetos perfeitamente."},
                {t:"CONTAMINACAO", d:"Medo excessivo de sujeira ou germes."},
                {t:"ACUMULACAO", d:"Dificuldade em descartar objetos (Hoarding)."},
                {t:"TRICOTILOMANIA", d:"Arrancar os pr√≥prios cabelos/pelos."},
                {t:"ALIVIO", d:"Sensa√ß√£o tempor√°ria ap√≥s realizar a compuls√£o."},
                {t:"INTRUSIVO", d:"Adjetivo para o pensamento que invade a mente."}
            ],
            trauma: [
                {t:"FLASHBACK", d:"Reviver o trauma como se estivesse acontecendo agora."},
                {t:"TEPT", d:"Transtorno de Estresse P√≥s-Traum√°tico."},
                {t:"DISSOCIACAO", d:"Desconex√£o da realidade ou do pr√≥prio corpo."},
                {t:"PESADELO", d:"Sonho perturbador recorrente sobre o evento."},
                {t:"GATILHO", d:"Est√≠mulo que dispara a mem√≥ria traum√°tica."},
                {t:"HIPERVIGILANCIA", d:"Estado de alerta constante para perigos."},
                {t:"EVITACAO", d:"Fugir de locais/pessoas que lembram o trauma."},
                {t:"APEGO", d:"Estilo de v√≠nculo afetado por traumas na inf√¢ncia."},
                {t:"ESTRESSE", d:"Rea√ß√£o aguda a eventos amea√ßadores."},
                {t:"RESILIENCIA", d:"Capacidade de recuperar-se ap√≥s o trauma."}
            ],
            alimentar: [
                {t:"ANOREXIA", d:"Restri√ß√£o alimentar severa e distor√ß√£o de imagem."},
                {t:"BULIMIA", d:"Compuls√£o seguida de purga√ß√£o (v√¥mito/laxante)."},
                {t:"COMPULSAO", d:"Ingest√£o exagerada de comida sem purga√ß√£o."},
                {t:"PICA", d:"Ingest√£o de subst√¢ncias n√£o nutritivas (terra, giz)."},
                {t:"IMAGEM", d:"Percep√ß√£o distorcida do pr√≥prio corpo."},
                {t:"CONTROLE", d:"Tema central psicol√≥gico na anorexia."},
                {t:"IMC", d:"√çndice de Massa Corporal (muito baixo na anorexia)."},
                {t:"PURGACAO", d:"M√©todo compensat√≥rio para n√£o ganhar peso."},
                {t:"RUMINACAO", d:"Regurgita√ß√£o repetida do alimento."},
                {t:"CULPA", d:"Sentimento comum ap√≥s epis√≥dio de compuls√£o."}
            ],
            sono: [
                {t:"INSONIA", d:"Dificuldade para iniciar ou manter o sono."},
                {t:"APNEIA", d:"Parada respirat√≥ria durante o sono."},
                {t:"NARCOLEPSIA", d:"Ataques s√∫bitos de sono durante o dia."},
                {t:"HIGIENE", d:"Conjunto de h√°bitos para dormir melhor."},
                {t:"MELATONINA", d:"Horm√¥nio que regula o ciclo sono-vig√≠lia."},
                {t:"CIRCADIANO", d:"Ritmo biol√≥gico de aproximadamente 24 horas."},
                {t:"PARASSONIA", d:"Eventos anormais como sonambulismo."},
                {t:"REM", d:"Fase do sono onde ocorrem os sonhos v√≠vidos."},
                {t:"TERROR", d:"Noturno: despertar com gritos e medo intenso."},
                {t:"CANSACO", d:"Consequ√™ncia diurna da m√° qualidade do sono."}
            ],
            personalidade: [
                {t:"BORDERLINE", d:"Instabilidade emocional, medo de abandono, impulsividade."},
                {t:"NARCISISTA", d:"Grandiosidade, necessidade de admira√ß√£o, falta de empatia."},
                {t:"ANTISSOCIAL", d:"Desrespeito pelas normas, leis e direitos alheios."},
                {t:"PARANOIDE", d:"Desconfian√ßa excessiva e suspeita dos outros."},
                {t:"ESQUIZOIDE", d:"Desapego social e restri√ß√£o emocional."},
                {t:"HISTRIONICO", d:"Busca excessiva de aten√ß√£o e emotividade."},
                {t:"DEPENDENTE", d:"Necessidade excessiva de ser cuidado."},
                {t:"EVITATIVA", d:"Inibi√ß√£o social e hipersensibilidade a cr√≠ticas."},
                {t:"RIGIDEZ", d:"Caracter√≠stica comum no transtorno obsessivo-compulsivo (TPOC)."},
                {t:"CLUSTER", d:"Nome dado aos grupos A, B e C dos transtornos."}
            ],
            substancias: [
                {t:"TOLERANCIA", d:"Necessidade de doses maiores para o mesmo efeito."},
                {t:"ABSTINENCIA", d:"Sintomas f√≠sicos ao parar o uso da subst√¢ncia."},
                {t:"CRAVING", d:"Fissura ou desejo intenso de usar."},
                {t:"RECOMPENSA", d:"Sistema cerebral ativado pelas drogas."},
                {t:"ALCOOL", d:"Depressor do sistema nervoso central muito comum."},
                {t:"OPIOIDE", d:"Classe de drogas usada para dor, altamente viciante."},
                {t:"CONTROLE", d:"Perda deste √© crit√©rio fundamental do v√≠cio."},
                {t:"OVERDOSE", d:"Intoxica√ß√£o aguda que pode levar √† morte."},
                {t:"RECAIDA", d:"Retorno ao uso ap√≥s per√≠odo de sobriedade."},
                {t:"DOPAMINA", d:"Neurotransmissor liberado no uso."}
            ],
            neurocog: [
                {t:"ALZHEIMER", d:"Causa mais comum de dem√™ncia, afeta mem√≥ria recente."},
                {t:"DEMENCIA", d:"Decl√≠nio cognitivo que interfere na independ√™ncia."},
                {t:"DELIRIUM", d:"Estado confusional agudo e flutuante."},
                {t:"MEMORIA", d:"Fun√ß√£o cognitiva geralmente a primeira a falhar."},
                {t:"AFASIA", d:"Dificuldade na linguagem (fala ou compreens√£o)."},
                {t:"AGNOSIA", d:"Incapacidade de reconhecer objetos ou rostos."},
                {t:"EXECUCAO", d:"Perda da capacidade de planejar tarefas."},
                {t:"VASCULAR", d:"Dem√™ncia causada por AVCs ou problemas circulat√≥rios."},
                {t:"LEWY", d:"Dem√™ncia com corpos de... (alucina√ß√µes visuais)."},
                {t:"IDADE", d:"Principal fator de risco para transtornos neurocognitivos."}
            ],
            burnout: [
                {t:"EXAUSTAO", d:"Sentimento de estar drenado f√≠sica e emocionalmente."},
                {t:"CINISMO", d:"Despersonaliza√ß√£o e atitude negativa com o trabalho."},
                {t:"EFICACIA", d:"Sentimento de baixa realiza√ß√£o profissional."},
                {t:"TRABALHO", d:"Contexto exclusivo onde ocorre o Burnout (OMS)."},
                {t:"ESTRESSE", d:"Cr√¥nico: a causa raiz do problema."},
                {t:"LIMITES", d:"Necessidade de estabelecer... para prevenir."},
                {t:"FERIAS", d:"Pausa necess√°ria, mas nem sempre cura o burnout."},
                {t:"AMBIENTE", d:"Se for t√≥xico, contribui para o adoecimento."},
                {t:"VALORES", d:"Conflito entre os seus e os da empresa gera burnout."},
                {t:"APOIO", d:"Social: fator de prote√ß√£o importante."}
            ],
            tcc: [
                {t:"CRENCA", d:"Ideia central e r√≠gida sobre si mesmo ('Sou incapaz')."},
                {t:"AUTOMATICO", d:"Pensamento r√°pido que surge diante de uma situa√ß√£o."},
                {t:"EVIDENCIA", d:"Fatos que usamos para testar a validade do pensamento."},
                {t:"DISTORCAO", d:"Erro de l√≥gica mental (ex: catastrofiza√ß√£o)."},
                {t:"COMPORTAMENTO", d:"O que fazemos (C) em resposta ao pensamento (B)."},
                {t:"EMOCAO", d:"O que sentimos (C) derivado da interpreta√ß√£o."},
                {t:"SOCRATICO", d:"Questionamento usado para desafiar ideias."},
                {t:"EXPOSICAO", d:"T√©cnica para vencer medos enfrentando-os."},
                {t:"REGRA", d:"Suposi√ß√£o: 'Se eu fizer isso, ent√£o...'"},
                {t:"ATIVACAO", d:"T√©cnica para combater a depress√£o."}
            ]
        };

        // ============================================
        // ‚öôÔ∏è ENGINE DE GERA√á√ÉO (CROSSWORD GENERATOR)
        // ============================================
        
        const GRID_SIZE = 15;
        let gridArray = [];
        let placedWords = [];

        function generateGame() {
            const loading = document.getElementById('loading');
            loading.style.display = 'flex';

            // Pequeno delay para a UI atualizar
            setTimeout(() => {
                const category = document.getElementById('categorySelect').value;
                const wordList = [...wordDatabase[category]]; // Copia para n√£o alterar original
                
                // Tenta gerar um grid v√°lido (tenta 10x se falhar)
                let success = false;
                for(let i=0; i<10; i++) {
                    if(createGrid(wordList)) {
                        success = true;
                        break;
                    }
                }

                if(!success) {
                    alert("Erro ao gerar um layout complexo. Tentando simplificar...");
                    createGrid(wordList.slice(0, 6)); // Tenta com menos palavras
                }

                renderGrid();
                renderClues();
                renderAnswersModal();
                loading.style.display = 'none';
            }, 100);
        }

        function createGrid(words) {
            // Reinicia
            gridArray = Array(GRID_SIZE).fill(null).map(() => Array(GRID_SIZE).fill(null));
            placedWords = [];
            
            // Ordena palavras por tamanho (maiores primeiro para ser a "espinha dorsal")
            words.sort((a, b) => b.t.length - a.t.length);

            // Coloca a primeira palavra no meio (Horizontal)
            const first = words[0];
            const startRow = Math.floor(GRID_SIZE / 2);
            const startCol = Math.floor((GRID_SIZE - first.t.length) / 2);
            
            if(!placeWord(first, startRow, startCol, 'H')) return false;

            // Tenta colocar as outras
            for (let i = 1; i < words.length; i++) {
                const word = words[i];
                findBestPosition(word);
            }

            // Filtra se conseguiu colocar pelo menos 5 palavras
            return placedWords.length >= 5;
        }

        function findBestPosition(wordObj) {
            const text = wordObj.t;
            
            // Embaralha tentativas para criar layouts diferentes
            const potentialSpots = [];

            // Percorre letras da palavra que queremos colocar
            for (let i = 0; i < text.length; i++) {
                const char = text[i];

                // Procura esse char no grid j√° existente
                for (let r = 0; r < GRID_SIZE; r++) {
                    for (let c = 0; c < GRID_SIZE; c++) {
                        if (gridArray[r][c] === char) {
                            // Achou intersec√ß√£o. Verifica se √© poss√≠vel cruzar.
                            // Se a letra no grid √© parte de uma palavra H, tentamos colocar V. E vice-versa.
                            
                            // Tentativa Vertical
                            if (canPlace(text, r - i, c, 'V')) {
                                potentialSpots.push({r: r-i, c: c, dir: 'V'});
                            }
                            // Tentativa Horizontal
                            if (canPlace(text, r, c - i, 'H')) {
                                potentialSpots.push({r: r, c: c-i, dir: 'H'});
                            }
                        }
                    }
                }
            }

            if (potentialSpots.length > 0) {
                // Pega uma aleat√≥ria v√°lida
                const spot = potentialSpots[Math.floor(Math.random() * potentialSpots.length)];
                placeWord(wordObj, spot.r, spot.c, spot.dir);
                return true;
            }
            return false;
        }

        function canPlace(word, row, col, dir) {
            if (row < 0 || col < 0) return false;
            if (dir === 'H' && col + word.length > GRID_SIZE) return false;
            if (dir === 'V' && row + word.length > GRID_SIZE) return false;

            // Verifica colis√£o e vizinhos
            for (let i = 0; i < word.length; i++) {
                let r = row + (dir === 'V' ? i : 0);
                let c = col + (dir === 'H' ? i : 0);

                const currentCell = gridArray[r][c];
                
                // Se c√©lula j√° tem letra, tem que ser a MESMA letra (intersec√ß√£o)
                if (currentCell !== null && currentCell !== word[i]) return false;

                // Verifica√ß√£o de vizinhos (n√£o pode colar em outras palavras sem ser na intersec√ß√£o)
                // Se a c√©lula est√° vazia, ela n√£o pode ter vizinhos nas dire√ß√µes ortogonais
                if (currentCell === null) {
                    if (hasNeighbors(r, c, dir)) return false;
                }
            }
            
            // Verifica c√©lulas antes e depois da palavra (n√£o pode "emendar")
            let beforeR = row - (dir === 'V' ? 1 : 0);
            let beforeC = col - (dir === 'H' ? 1 : 0);
            if(beforeR >= 0 && beforeC >= 0 && gridArray[beforeR][beforeC] !== null) return false;

            let afterR = row + (dir === 'V' ? word.length : 0);
            let afterC = col + (dir === 'H' ? word.length : 0);
            if(afterR < GRID_SIZE && afterC < GRID_SIZE && gridArray[afterR][afterC] !== null) return false;

            return true;
        }

        function hasNeighbors(r, c, dir) {
            // Se estou colocando H, verifico vizinhos V (cima/baixo)
            if(dir === 'H') {
                if(r > 0 && gridArray[r-1][c] !== null) return true;
                if(r < GRID_SIZE-1 && gridArray[r+1][c] !== null) return true;
            } else {
                if(c > 0 && gridArray[r][c-1] !== null) return true;
                if(c < GRID_SIZE-1 && gridArray[r][c+1] !== null) return true;
            }
            return false;
        }

        function placeWord(wordObj, r, c, dir) {
            for (let i = 0; i < wordObj.t.length; i++) {
                let currR = r + (dir === 'V' ? i : 0);
                let currC = c + (dir === 'H' ? i : 0);
                gridArray[currR][currC] = wordObj.t[i];
            }
            
            placedWords.push({
                ...wordObj,
                row: r, col: c, dir: dir, number: placedWords.length + 1
            });
            return true;
        }

        // ============================================
        // üé® RENDERIZA√á√ÉO E UI
        // ============================================

        function renderGrid() {
            const gridEl = document.getElementById('crosswordGrid');
            gridEl.innerHTML = '';
            gridEl.style.gridTemplateColumns = `repeat(${GRID_SIZE}, var(--cell-size))`;

            // Mapa para colocar n√∫meros
            const numbersMap = {};
            placedWords.forEach(w => {
                const key = `${w.row},${w.col}`;
                if(!numbersMap[key]) numbersMap[key] = w.number;
            });

            for(let r=0; r<GRID_SIZE; r++) {
                for(let c=0; c<GRID_SIZE; c++) {
                    const char = gridArray[r][c];
                    const div = document.createElement('div');
                    
                    if(char) {
                        div.className = 'cell active';
                        const num = numbersMap[`${r},${c}`] || '';
                        
                        div.innerHTML = `
                            <input type="text" maxlength="1" 
                                data-r="${r}" data-c="${c}" 
                                data-char="${char}"
                                onkeydown="handleNav(this, event)"
                                oninput="this.value = this.value.toUpperCase()">
                            ${num ? `<span class="cell-num">${num}</span>` : ''}
                        `;
                    } else {
                        div.className = 'cell';
                    }
                    gridEl.appendChild(div);
                }
            }
        }

        function renderClues() {
            const listH = document.getElementById('listH');
            const listV = document.getElementById('listV');
            listH.innerHTML = ''; listV.innerHTML = '';

            placedWords.forEach(w => {
                const item = document.createElement('div');
                item.className = 'clue-item';
                item.innerHTML = `<strong>${w.number}.</strong> ${w.d}`;
                item.onclick = () => highlightWord(w);

                if(w.dir === 'H') listH.appendChild(item);
                else listV.appendChild(item);
            });
            
            // Ativa aba H por padr√£o
            switchTab('H');
        }

        function switchTab(type) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-btn')[type === 'H' ? 0 : 1].classList.add('active');
            
            document.getElementById('listH').style.display = type === 'H' ? 'block' : 'none';
            document.getElementById('listV').style.display = type === 'V' ? 'block' : 'none';
        }

        // --- NAVEGA√á√ÉO ---
        function handleNav(input, e) {
            const r = parseInt(input.dataset.r);
            const c = parseInt(input.dataset.c);

            if(e.key.startsWith("Arrow")) {
                e.preventDefault();
                if(e.key === "ArrowRight") focusNext(r, c+1, 0, 1);
                if(e.key === "ArrowLeft") focusNext(r, c-1, 0, -1);
                if(e.key === "ArrowDown") focusNext(r+1, c, 1, 0);
                if(e.key === "ArrowUp") focusNext(r-1, c, -1, 0);
            }
            
            if(e.key === "Backspace" && input.value === "") {
                // Tenta voltar
                if(!focusNext(r, c-1, 0, -1)) focusNext(r-1, c, -1, 0);
            }
        }

        function focusNext(r, c, dr, dc) {
            // Procura a pr√≥xima c√©lula v√°lida na dire√ß√£o
            // L√≥gica simples: tenta a c√©lula imediata
            const next = document.querySelector(`input[data-r="${r}"][data-c="${c}"]`);
            if(next) {
                next.focus();
                return true;
            }
            return false;
        }

        function checkGame() {
            const inputs = document.querySelectorAll('.cell.active input');
            let allCorrect = true;
            let filled = 0;

            inputs.forEach(inp => {
                const correctChar = inp.dataset.char;
                const userChar = inp.value.toUpperCase();
                
                inp.parentElement.classList.remove('correct', 'wrong');

                if(userChar) {
                    filled++;
                    if(userChar === correctChar) {
                        inp.parentElement.classList.add('correct');
                    } else {
                        inp.parentElement.classList.add('wrong');
                        allCorrect = false;
                    }
                } else {
                    allCorrect = false;
                }
            });

            if(allCorrect && filled === inputs.length) {
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                alert("Parab√©ns! Voc√™ domina este tema!");
            }
        }

        function highlightWord(w) {
            // Limpa highlights anteriores
            document.querySelectorAll('.cell input').forEach(i => i.parentElement.style.background = '');
            
            // Foca na primeira letra
            const first = document.querySelector(`input[data-r="${w.row}"][data-c="${w.col}"]`);
            if(first) first.focus();
        }

        function resetGrid() {
            if(confirm("Limpar todo o progresso?")) {
                document.querySelectorAll('.cell input').forEach(i => {
                    i.value = '';
                    i.parentElement.classList.remove('correct', 'wrong');
                });
            }
        }

        // --- GABARITO ---
        function renderAnswersModal() {
            const list = document.getElementById('modalList');
            list.innerHTML = '';
            
            // Ordena por n√∫mero
            placedWords.sort((a,b) => a.number - b.number).forEach(w => {
                const div = document.createElement('div');
                div.className = 'answer-card';
                div.innerHTML = `
                    <span class="ans-term">${w.number}. ${w.t}</span>
                    <span class="ans-def">${w.d}</span>
                `;
                list.appendChild(div);
            });
        }

        function showAnswers() {
            if(confirm("Tem certeza que deseja ver as respostas?")) {
                document.getElementById('modalAnswers').style.display = 'flex';
            }
        }
        function closeModal() {
            document.getElementById('modalAnswers').style.display = 'none';
        }

        // Inicia o jogo
        window.onload = generateGame;

    </script>
</body>
</html>
